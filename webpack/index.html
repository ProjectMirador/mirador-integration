<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Basic Mirador</title>
    <script src="dist/main.js"></script>
</head>
<body>
<div id="demo"></div>
<script>
    class StorageAdapter {
        constructor(annotationPageId) {
            this.annoPage = {
                id: annotationPageId,
                items: JSON.parse("[]"),
                type: 'AnnotationPage',
            };
        };

        async all() {
            return this.annoPage;
        };

        async create(annotation) {
            const annotationPage = await this.all();
            annotationPage.items.push(annotation);
            return annotationPage;
        };

        async update(annotation) {
            const annotationPage = await this.all();
            const currentIndex = annotationPage.items.findIndex((item) => item.id === annotation.id);
            annotationPage.items.splice(currentIndex, 1, annotation);
            localStorage.setItem(this.annotationPageId, JSON.stringify(annotationPage));
            return annotationPage;
        };

        async delete(annoId) {
            const annotationPage = await this.all();
            if (annotationPage) {
                annotationPage.items = annotationPage.items.filter((item) => item.id !== annoId);
            }
            localStorage.setItem(this.annotationPageId, JSON.stringify(annotationPage));
            return annotationPage;
        }

        async get(annoId) {
            const annotationPage = await this.all();
            if (annotationPage) {
                return annotationPage.items.find((item) => item.id === annoId);
            }
            return null;
        }
    }

    const config = {
        id: 'demo',
        windows: [{
            imageToolsEnabled: true,
            imageToolsOpen: true,
            manifestId: 'https://purl.stanford.edu/sn904cj3429/iiif/manifest',
        }],
        window: {
            defaultSideBarPanel: 'annotations',
            sideBarOpenByDefault: true,
            "highlightAllAnnotations": true,
        },
        annotation: {
            adapter: (canvasId) => new StorageAdapter(canvasId),
            exportLocalStorageAnnotations: false,
        },
        theme: {
            palette: {
                primary: {
                    main: '#1967d2',
                },
            },
        },
    };

    PackagedMirador.Mirador.viewer(config, [
        ...PackagedMirador.miradorImageToolsPlugin, ...PackagedMirador.miradorAnnotationPlugins
    ]);
</script>
</body>
</html>
